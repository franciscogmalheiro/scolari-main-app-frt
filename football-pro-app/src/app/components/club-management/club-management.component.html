<div class="club-management">
  <!-- Header -->
  <div class="management-header">
    <div class="header-content">
      <h2>Club Management</h2>
      <button class="create-btn" (click)="openCreateModal()">
        <span class="btn-icon">➕</span>
        Add New Club
      </button>
    </div>
  </div>

  <!-- Messages -->
  <div *ngIf="errorMessage" class="message error-message">
    <span class="message-icon">⚠️</span>
    {{ errorMessage }}
  </div>

  <div *ngIf="successMessage" class="message success-message">
    <span class="message-icon">✅</span>
    {{ successMessage }}
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading clubs...</p>
  </div>

  <!-- Clubs Table -->
  <div *ngIf="!isLoading" class="table-container">
    <table class="clubs-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
          <th>Founded</th>
          <th>Address</th>
          <th>Location</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let club of clubs">
          <tr class="club-row" [class.expanded]="isClubExpanded(club.id)">
            <td class="club-name" (click)="toggleClubExpansion(club)" style="cursor: pointer;">
              <span class="expand-icon" [class.expanded]="isClubExpanded(club.id)">▶</span>
              {{ club.name }}
            </td>
            <td class="club-description">{{ club.description || 'N/A' }}</td>
            <td class="club-founded">{{ getFoundedYearDisplay(club.foundedYear) }}</td>
            <td class="club-address">{{ club.address || 'N/A' }}</td>
            <td class="club-location">{{ getLocationDisplay(club) }}</td>
            <td class="club-date">{{ club.createdAt | date:'short' }}</td>
            <td class="club-actions">
              <button class="action-btn edit-btn" (click)="openEditModal(club)" title="Edit Club">
                <span class="action-icon">✏️</span>
              </button>
              <button class="action-btn delete-btn" (click)="openDeleteModal(club)" title="Delete Club">
                <span class="action-icon">🗑️</span>
              </button>
            </td>
          </tr>
          
          <!-- Expanded club fields row -->
          <tr *ngIf="isClubExpanded(club.id)" class="club-fields-row">
            <td colspan="7" class="fields-container">
              <div class="fields-header">
                <h4>Club Fields</h4>
                <button class="create-btn small" (click)="openFieldCreateModal(club)">
                  <span class="btn-icon">➕</span>
                  Add Field
                </button>
              </div>
              
              <!-- Loading state for fields -->
              <div *ngIf="loadingFields[club.id]" class="loading-container small">
                <div class="loading-spinner small"></div>
                <p>Loading fields...</p>
              </div>
              
              <!-- Fields table -->
              <div *ngIf="!loadingFields[club.id] && clubFields[club.id] && clubFields[club.id].length > 0" class="fields-table-container">
                <table class="fields-table">
                  <thead>
                    <tr>
                      <th>Field Name</th>
                      <th>Sports</th>
                      <th>Created</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                                      <tr *ngFor="let field of clubFields[club.id]" class="field-row">
                    <td class="field-name">{{ field.fieldName }}</td>
                    <td class="field-sports">{{ getSportsDisplay(field.fieldSports) }}</td>
                    <td class="field-date">N/A</td>
                      <td class="field-actions">
                        <button class="action-btn edit-btn small" (click)="openFieldEditModal(field, club)" title="Edit Field">
                          <span class="action-icon">✏️</span>
                        </button>
                        <button class="action-btn delete-btn small" (click)="openFieldDeleteModal(field, club)" title="Delete Field">
                          <span class="action-icon">🗑️</span>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              
              <!-- Empty state for fields -->
              <div *ngIf="!loadingFields[club.id] && (!clubFields[club.id] || clubFields[club.id]?.length === 0)" class="empty-fields">
                <p>No fields found for this club.</p>
                <button class="create-btn small" (click)="openFieldCreateModal(club)">
                  <span class="btn-icon">➕</span>
                  Add First Field
                </button>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>

    <!-- Empty State -->
    <div *ngIf="clubs.length === 0" class="empty-state">
      <div class="empty-icon">🏆</div>
      <h3>No Clubs Found</h3>
      <p>Get started by adding your first club.</p>
      <button class="create-btn" (click)="openCreateModal()">
        <span class="btn-icon">➕</span>
        Add First Club
      </button>
    </div>
  </div>

  <!-- Create Club Modal -->
  <div *ngIf="showCreateModal" class="modal-overlay" (click)="closeModals()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Create New Club</h3>
        <button class="close-btn" (click)="closeModals()">✕</button>
      </div>
      
      <form [formGroup]="clubForm" (ngSubmit)="createClub()" class="modal-form">
        <div class="form-group">
          <label for="name">Club Name *</label>
          <input 
            type="text" 
            id="name"
            formControlName="name"
            placeholder="Enter club name"
            [class.error]="clubForm.get('name')?.invalid && clubForm.get('name')?.touched"
          >
          <div *ngIf="clubForm.get('name')?.invalid && clubForm.get('name')?.touched" class="error-text">
            <span *ngIf="clubForm.get('name')?.errors?.['required']">Club name is required</span>
            <span *ngIf="clubForm.get('name')?.errors?.['minlength']">Club name must be at least 2 characters</span>
          </div>
        </div>

        <div class="form-group">
          <label for="description">Description</label>
          <textarea 
            id="description"
            formControlName="description"
            placeholder="Enter club description"
            rows="3"
            [class.error]="clubForm.get('description')?.invalid && clubForm.get('description')?.touched"
          ></textarea>
        </div>

        <div class="form-group">
          <label for="foundedYear">Founded Year</label>
          <input 
            type="number" 
            id="foundedYear"
            formControlName="foundedYear"
            placeholder="Enter founded year"
            [class.error]="clubForm.get('foundedYear')?.invalid && clubForm.get('foundedYear')?.touched"
          >
          <div *ngIf="clubForm.get('foundedYear')?.invalid && clubForm.get('foundedYear')?.touched" class="error-text">
            <span *ngIf="clubForm.get('foundedYear')?.errors?.['min']">Founded year must be at least 1800</span>
            <span *ngIf="clubForm.get('foundedYear')?.errors?.['max']">Founded year cannot be in the future</span>
          </div>
        </div>

        <div class="form-group">
          <label for="address">Address</label>
          <input 
            type="text" 
            id="address"
            formControlName="address"
            placeholder="Enter club address"
            [class.error]="clubForm.get('address')?.invalid && clubForm.get('address')?.touched"
          >
          <div *ngIf="clubForm.get('address')?.invalid && clubForm.get('address')?.touched" class="error-text">
            <span *ngIf="clubForm.get('address')?.errors?.['minlength']">Address must be at least 5 characters</span>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="city">City</label>
            <input 
              type="text" 
              id="city"
              formControlName="city"
              placeholder="Enter city"
              [class.error]="clubForm.get('city')?.invalid && clubForm.get('city')?.touched"
            >
            <div *ngIf="clubForm.get('city')?.invalid && clubForm.get('city')?.touched" class="error-text">
              <span *ngIf="clubForm.get('city')?.errors?.['minlength']">City must be at least 2 characters</span>
            </div>
          </div>

          <div class="form-group">
            <label for="country">Country</label>
            <input 
              type="text" 
              id="country"
              formControlName="country"
              placeholder="Enter country"
              [class.error]="clubForm.get('country')?.invalid && clubForm.get('country')?.touched"
            >
            <div *ngIf="clubForm.get('country')?.invalid && clubForm.get('country')?.touched" class="error-text">
              <span *ngIf="clubForm.get('country')?.errors?.['minlength']">Country must be at least 2 characters</span>
            </div>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="cancel-btn" (click)="closeModals()">Cancel</button>
          <button type="submit" class="submit-btn" [disabled]="clubForm.invalid || isLoading">
            <span *ngIf="isLoading" class="loading-spinner-small"></span>
            {{ isLoading ? 'Creating...' : 'Create Club' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Edit Club Modal -->
  <div *ngIf="showEditModal" class="modal-overlay" (click)="closeModals()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Edit Club</h3>
        <button class="close-btn" (click)="closeModals()">✕</button>
      </div>
      
      <form [formGroup]="clubForm" (ngSubmit)="updateClub()" class="modal-form">
        <div class="form-group">
          <label for="edit-name">Club Name *</label>
          <input 
            type="text" 
            id="edit-name"
            formControlName="name"
            placeholder="Enter club name"
            [class.error]="clubForm.get('name')?.invalid && clubForm.get('name')?.touched"
          >
          <div *ngIf="clubForm.get('name')?.invalid && clubForm.get('name')?.touched" class="error-text">
            <span *ngIf="clubForm.get('name')?.errors?.['required']">Club name is required</span>
            <span *ngIf="clubForm.get('name')?.errors?.['minlength']">Club name must be at least 2 characters</span>
          </div>
        </div>

        <div class="form-group">
          <label for="edit-description">Description</label>
          <textarea 
            id="edit-description"
            formControlName="description"
            placeholder="Enter club description"
            rows="3"
            [class.error]="clubForm.get('description')?.invalid && clubForm.get('description')?.touched"
          ></textarea>
        </div>

        <div class="form-group">
          <label for="edit-foundedYear">Founded Year</label>
          <input 
            type="number" 
            id="edit-foundedYear"
            formControlName="foundedYear"
            placeholder="Enter founded year"
            [class.error]="clubForm.get('foundedYear')?.invalid && clubForm.get('foundedYear')?.touched"
          >
          <div *ngIf="clubForm.get('foundedYear')?.invalid && clubForm.get('foundedYear')?.touched" class="error-text">
            <span *ngIf="clubForm.get('foundedYear')?.errors?.['min']">Founded year must be at least 1800</span>
            <span *ngIf="clubForm.get('foundedYear')?.errors?.['max']">Founded year cannot be in the future</span>
          </div>
        </div>

        <div class="form-group">
          <label for="edit-address">Address</label>
          <input 
            type="text" 
            id="edit-address"
            formControlName="address"
            placeholder="Enter club address"
            [class.error]="clubForm.get('address')?.invalid && clubForm.get('address')?.touched"
          >
          <div *ngIf="clubForm.get('address')?.invalid && clubForm.get('address')?.touched" class="error-text">
            <span *ngIf="clubForm.get('address')?.errors?.['minlength']">Address must be at least 5 characters</span>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="edit-city">City</label>
            <input 
              type="text" 
              id="edit-city"
              formControlName="city"
              placeholder="Enter city"
              [class.error]="clubForm.get('city')?.invalid && clubForm.get('city')?.touched"
            >
            <div *ngIf="clubForm.get('city')?.invalid && clubForm.get('city')?.touched" class="error-text">
              <span *ngIf="clubForm.get('city')?.errors?.['minlength']">City must be at least 2 characters</span>
            </div>
          </div>

          <div class="form-group">
            <label for="edit-country">Country</label>
            <input 
              type="text" 
              id="edit-country"
              formControlName="country"
              placeholder="Enter country"
              [class.error]="clubForm.get('country')?.invalid && clubForm.get('country')?.touched"
            >
            <div *ngIf="clubForm.get('country')?.invalid && clubForm.get('country')?.touched" class="error-text">
              <span *ngIf="clubForm.get('country')?.errors?.['minlength']">Country must be at least 2 characters</span>
            </div>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="cancel-btn" (click)="closeModals()">Cancel</button>
          <button type="submit" class="submit-btn" [disabled]="clubForm.invalid || isLoading">
            <span *ngIf="isLoading" class="loading-spinner-small"></span>
            {{ isLoading ? 'Updating...' : 'Update Club' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div *ngIf="showDeleteModal" class="modal-overlay" (click)="closeModals()">
    <div class="modal-content delete-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Delete Club</h3>
        <button class="close-btn" (click)="closeModals()">✕</button>
      </div>
      
      <div class="delete-content">
        <div class="delete-icon">🗑️</div>
        <h4>Are you sure you want to delete this club?</h4>
        <p class="delete-warning">
          <strong>{{ selectedClub?.name }}</strong> will be permanently deleted and cannot be recovered.
        </p>
        
        <div class="modal-actions">
          <button type="button" class="cancel-btn" (click)="closeModals()">Cancel</button>
          <button type="button" class="delete-confirm-btn" (click)="deleteClub()" [disabled]="isLoading">
            <span *ngIf="isLoading" class="loading-spinner-small"></span>
            {{ isLoading ? 'Deleting...' : 'Delete Club' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Field Modal -->
  <div *ngIf="showFieldCreateModal" class="modal-overlay" (click)="closeFieldModals()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Create New Field for {{ selectedClubForField?.name }}</h3>
        <button class="close-btn" (click)="closeFieldModals()">✕</button>
      </div>
      
      <form [formGroup]="fieldForm" (ngSubmit)="createField()" class="modal-form">
        <div class="form-group">
          <label for="field-name">Field Name *</label>
          <input 
            type="text" 
            id="field-name"
            formControlName="name"
            placeholder="Enter field name"
            [class.error]="fieldForm.get('name')?.invalid && fieldForm.get('name')?.touched"
          >
          <div *ngIf="fieldForm.get('name')?.invalid && fieldForm.get('name')?.touched" class="error-text">
            <span *ngIf="fieldForm.get('name')?.errors?.['required']">Field name is required</span>
            <span *ngIf="fieldForm.get('name')?.errors?.['minlength']">Field name must be at least 2 characters</span>
          </div>
        </div>

        <div class="form-group">
          <label for="field-sports">Sports *</label>
          <select 
            id="field-sports"
            formControlName="sportIds"
            multiple
            [class.error]="fieldForm.get('sportIds')?.invalid && fieldForm.get('sportIds')?.touched"
          >
            <option *ngFor="let sport of sports" [value]="sport.id">{{ sport.name }}</option>
          </select>
          <div *ngIf="fieldForm.get('sportIds')?.invalid && fieldForm.get('sportIds')?.touched" class="error-text">
            <span *ngIf="fieldForm.get('sportIds')?.errors?.['required']">At least one sport is required</span>
            <span *ngIf="fieldForm.get('sportIds')?.errors?.['minlength']">At least one sport must be selected</span>
          </div>
          <small class="help-text">Hold Ctrl/Cmd to select multiple sports</small>
        </div>

        <div class="modal-actions">
          <button type="button" class="cancel-btn" (click)="closeFieldModals()">Cancel</button>
          <button type="submit" class="submit-btn" [disabled]="fieldForm.invalid || isLoading">
            <span *ngIf="isLoading" class="loading-spinner-small"></span>
            {{ isLoading ? 'Creating...' : 'Create Field' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Edit Field Modal -->
  <div *ngIf="showFieldEditModal" class="modal-overlay" (click)="closeFieldModals()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Edit Field for {{ selectedClubForField?.name }}</h3>
        <button class="close-btn" (click)="closeFieldModals()">✕</button>
      </div>
      
      <form [formGroup]="fieldForm" (ngSubmit)="updateField()" class="modal-form">
        <div class="form-group">
          <label for="edit-field-name">Field Name *</label>
          <input 
            type="text" 
            id="edit-field-name"
            formControlName="name"
            placeholder="Enter field name"
            [class.error]="fieldForm.get('name')?.invalid && fieldForm.get('name')?.touched"
          >
          <div *ngIf="fieldForm.get('name')?.invalid && fieldForm.get('name')?.touched" class="error-text">
            <span *ngIf="fieldForm.get('name')?.errors?.['required']">Field name is required</span>
            <span *ngIf="fieldForm.get('name')?.errors?.['minlength']">Field name must be at least 2 characters</span>
          </div>
        </div>

        <div class="form-group">
          <label for="edit-field-sports">Sports *</label>
          <select 
            id="edit-field-sports"
            formControlName="sportIds"
            multiple
            [class.error]="fieldForm.get('sportIds')?.invalid && fieldForm.get('sportIds')?.touched"
          >
            <option *ngFor="let sport of sports" [value]="sport.id">{{ sport.name }}</option>
          </select>
          <div *ngIf="fieldForm.get('sportIds')?.invalid && fieldForm.get('sportIds')?.touched" class="error-text">
            <span *ngIf="fieldForm.get('sportIds')?.errors?.['required']">At least one sport is required</span>
            <span *ngIf="fieldForm.get('sportIds')?.errors?.['minlength']">At least one sport must be selected</span>
          </div>
          <small class="help-text">Hold Ctrl/Cmd to select multiple sports</small>
        </div>

        <div class="modal-actions">
          <button type="button" class="cancel-btn" (click)="closeFieldModals()">Cancel</button>
          <button type="submit" class="submit-btn" [disabled]="fieldForm.invalid || isLoading">
            <span *ngIf="isLoading" class="loading-spinner-small"></span>
            {{ isLoading ? 'Updating...' : 'Update Field' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Field Confirmation Modal -->
  <div *ngIf="showFieldDeleteModal" class="modal-overlay" (click)="closeFieldModals()">
    <div class="modal-content delete-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Delete Field</h3>
        <button class="close-btn" (click)="closeFieldModals()">✕</button>
      </div>
      
      <div class="delete-content">
        <div class="delete-icon">🗑️</div>
        <h4>Are you sure you want to delete this field?</h4>
        <p class="delete-warning">
          <strong>{{ selectedField?.fieldName }}</strong> from <strong>{{ selectedClubForField?.name }}</strong> will be permanently deleted and cannot be recovered.
        </p>
        
        <div class="modal-actions">
          <button type="button" class="cancel-btn" (click)="closeFieldModals()">Cancel</button>
          <button type="button" class="delete-confirm-btn" (click)="deleteField()" [disabled]="isLoading">
            <span *ngIf="isLoading" class="loading-spinner-small"></span>
            {{ isLoading ? 'Deleting...' : 'Delete Field' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div> 