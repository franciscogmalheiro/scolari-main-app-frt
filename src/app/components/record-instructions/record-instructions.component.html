<div class="record-instructions-container">
  <app-header></app-header>

  <main class="main-content">
    <div class="instructions-card">
      <div class="card-header">
        <h1 class="card-title">Instru√ß√µes do Marcador</h1>
      </div>

      <div class="instructions-content">
        <!-- Recording Code Section (only shown when no code is validated) -->
        <div class="recording-code-section" *ngIf="!validatedRecordingCode">
          <div class="section-header" *ngIf="!validatedRecordingCode">
            <h3>Grava√ß√£o do Jogo</h3>
            <p class="description">
              Para gravar o jogo, falar com o respons√°vel pelo campo para obter um c√≥digo de grava√ß√£o.
              Se n√£o tiver c√≥digo, pode continuar apenas com o marcador de jogo.
            </p>
          </div>
          
          <!-- Code validation form (only shown when no code is validated yet) -->
          <form [formGroup]="recordingCodeForm" (ngSubmit)="validateRecordingCode()" *ngIf="!validatedRecordingCode">
            <div class="code-input-group">
              <input 
                type="text" 
                formControlName="code" 
                placeholder="C√≥digo de grava√ß√£o"
                class="code-input"
                [class.error]="codeValidationFailed">
              <button 
                type="submit" 
                class="validate-button"
                [disabled]="recordingCodeForm.invalid || isValidatingCode">
                <span *ngIf="!isValidatingCode">Validar C√≥digo</span>
                <span *ngIf="isValidatingCode" class="spinner"></span>
              </button>
            </div>
            
            <!-- Code validation error -->
            <div *ngIf="codeValidationFailed" class="validation-error">
              <span class="error-icon">‚ùå</span>
              <span>{{ codeValidationError }}</span>
            </div>
          </form>
          
        </div>


        <!-- Instructions (only shown when recording code is validated) -->
        <div class="instruction-items" *ngIf="validatedRecordingCode">
          <h3>O teu c√≥digo √© v√°lido, e o teu jogo ir√° ser gravado.</h3>
          <div class="instruction-item">
            <div class="instruction-number">1</div>
            <div class="instruction-text">
              A grava√ß√£o do jogo ter√° inicio assim que o bot√£o "iniciar" for premido.
            </div>
          </div>

          <div class="instruction-item">
            <div class="instruction-number">2</div>
            <div class="instruction-text">
              A grava√ß√£o ter√° fim assim que o bot√£o "terminar" for premido ou excedido o tempo limite de 90min.
            </div>
          </div>

          <div class="instruction-item">
            <div class="instruction-number">3</div>
            <div class="instruction-text">
              Assim que o bot√£o "terminar" for pressionado, ser√° apresentado o ID de jogo que vai precisar para descarregar o video.
            </div>
          </div>
        </div>

        <!-- Camera Health Check Section (only for recording mode) -->
        <div class="camera-health-section" *ngIf="validatedRecordingCode">
          <div class="health-check-header">
            <h3>Verifica√ß√£o da C√¢mara</h3>
          </div>
          
          <!-- Loading Cameras State -->
          <div *ngIf="isLoadingCameras" class="health-status loading">
            <div class="spinner"></div>
            <span>A carregar c√¢maras dispon√≠veis...</span>
          </div>

          <!-- Loading State -->
          <div *ngIf="isCheckingCamera && !isLoadingCameras" class="health-status loading">
            <div class="spinner"></div>
            <span>A verificar liga√ß√£o da c√¢mara...</span>
          </div>

          <!-- Success State -->
          <div *ngIf="cameraHealthCheckPassed && !isCheckingCamera && !isLoadingCameras" class="health-status success">
            <span class="status-icon">‚úÖ</span>
            <span>C√¢mara conectada com sucesso</span>
            <div *ngIf="selectedCamera" class="camera-info">
              <small>{{ selectedCamera.cameraName }} ({{ selectedCamera.cameraModel }})</small>
            </div>
          </div>

          <!-- Error State -->
          <div *ngIf="cameraHealthCheckFailed && !isCheckingCamera && !isLoadingCameras" class="health-status error">
            <span class="status-icon">‚ùå</span>
            <span>{{ errorMessage }}</span>
            <button class="retry-button" (click)="retryCameraCheck()">
              Tentar Novamente
            </button>
          </div>
        </div>
      </div>

      <div class="card-footer">
        <button class="back-button" (click)="onBackClick()">
          <span class="button-arrow">‚Üê</span>
          <span>Voltar</span>
        </button>
        
        <!-- Continue without recording button (only shown when no code is validated) -->
        <button 
          *ngIf="!validatedRecordingCode"
          class="continue-button"
          (click)="continueWithoutRecording()"
          [disabled]="isValidatingCode">
          <span class="button-icon">üìä</span>
          <span>Continuar sem grava√ß√£o</span>
        </button>
        
        <!-- Next button (only shown when code is validated) -->
        <button 
          *ngIf="validatedRecordingCode"
          class="next-button" 
          [class.disabled]="!canProceed()"
          [disabled]="!canProceed()"
          (click)="onNextClick()">
          <span>Pr√≥ximo</span>
          <span class="button-arrow">‚Üí</span>
        </button>
      </div>
    </div>
  </main>
</div> 