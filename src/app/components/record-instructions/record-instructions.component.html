<div class="record-instructions-container">
  <app-header></app-header>

  <main class="main-content">
    <div class="instructions-card">
      <div class="card-header">
        <h1 class="card-title">Instruções</h1>
      </div>

      <div class="instructions-content">
        <!-- Recording Code Section (only shown when no code is validated) -->
        <div class="recording-code-section" *ngIf="!validatedRecordingCode">
          <div class="section-header" *ngIf="!validatedRecordingCode">
            <h3>Queres gravar o jogo?</h3>
            <p class="description">
              Para gravar o jogo, precisas de um <strong>código de gravação</strong> que podes obter junto do responsável deste campo.
              Se não tiveres código, podes continuar apenas com o marcador de jogo.
            </p>
          </div>
          
          <!-- Code validation form (only shown when no code is validated yet) -->
          <form [formGroup]="recordingCodeForm" (ngSubmit)="validateRecordingCode()" *ngIf="!validatedRecordingCode">
            <div class="code-input-group">
              <input 
                type="text" 
                formControlName="code" 
                placeholder="Código de gravação"
                class="code-input"
                [class.error]="codeValidationFailed">
              <button 
                type="submit" 
                class="button-green"
                [disabled]="recordingCodeForm.invalid || isValidatingCode">
                <span *ngIf="!isValidatingCode">Validar Código</span>
                <span *ngIf="isValidatingCode" class="spinner"></span>
              </button>
            </div>
            
            <!-- Code validation error -->
            <div *ngIf="codeValidationFailed" class="validation-error">
              <span class="error-icon">❌</span>
              <span>{{ codeValidationError }}</span>
            </div>
          </form>
          
        </div>


        <!-- Instructions (only shown when recording code is validated) -->
        <div class="instruction-items" *ngIf="validatedRecordingCode">
          <h3>O código que inseriste é válido, podes prosseguir com a gravação!</h3>
          <div class="instruction-item">
            <div class="instruction-number">1</div>
            <div class="instruction-text">
              Edita nome e cor das equipas
            </div>
          </div>

          <div class="instruction-item">
            <div class="instruction-number">2</div>
            <div class="instruction-text">
              Prime "Começar jogo" para iniciar a gravação
            </div>
          </div>

          <div class="instruction-item">
            <div class="instruction-number">3</div>
            <div class="instruction-text">
              Usa os botões de "golo" e de "destaque" para registar os momentos do jogo
            </div>
          </div>

          <div class="instruction-item">
            <div class="instruction-number">4</div>
            <div class="instruction-text">
              Se precisares de corrigir um momento registado por engano utiliza o botão "corrigir"
            </div>
          </div>
          <div class="instruction-item">
              <div class="instruction-number">5</div>
              <div class="instruction-text">
                Prime "terminar jogo" no final da partida
              </div>
          </div>
          <div class="instruction-item">
              <div class="instruction-number">6</div>
              <div class="instruction-text">
                Revê o resumo e melhores momentos do jogo
              </div>
          </div>
        </div>

        <!-- Camera Health Check Section (only for recording mode) -->
        <div class="camera-health-section" *ngIf="validatedRecordingCode">
          <div class="health-check-header">
            <h3>Verificação da Câmara</h3>
          </div>
          
          <!-- Loading Cameras State -->
          <div *ngIf="isLoadingCameras" class="health-status loading">
            <div class="spinner"></div>
            <span>A carregar câmaras disponíveis...</span>
          </div>

          <!-- Loading State -->
          <div *ngIf="isCheckingCamera && !isLoadingCameras" class="health-status loading">
            <div class="spinner"></div>
            <span>A verificar ligação da câmara...</span>
          </div>

          <!-- Success State -->
          <div *ngIf="cameraHealthCheckPassed && !isCheckingCamera && !isLoadingCameras" class="health-status success">
            <span class="status-icon">✅</span>
            <span>Câmara conectada com sucesso</span>
          
          </div>

          <!-- Error State -->
          <div *ngIf="cameraHealthCheckFailed && !isCheckingCamera && !isLoadingCameras" class="health-status error">
            <span class="status-icon">❌</span>
            <span>{{ errorMessage }}</span>
            <button class="retry-button" (click)="retryCameraCheck()">
              Tentar Novamente
            </button>
          </div>
        </div>
      </div>

      <div class="card-footer">
        <button class="button-red" (click)="onBackClick()">
          <span class="button-arrow">&lt;</span>
          <span>Voltar</span>
        </button>
        
        <!-- Continue without recording button (only shown when no code is validated) -->
        <button 
          *ngIf="!validatedRecordingCode"
          class="button-grey"
          (click)="continueWithoutRecording()"
          [disabled]="isValidatingCode">
          <span>Não gravar</span>
        </button>
        
        <!-- Next button (only shown when code is validated) -->
        <button 
          *ngIf="validatedRecordingCode"
          class="button-green" 
          [class.disabled]="!canProceed()"
          [disabled]="!canProceed()"
          (click)="onNextClick()">
          <span>Gravar</span>
          <span class="button-arrow">></span>
        </button>
      </div>
    </div>
  </main>
</div> 