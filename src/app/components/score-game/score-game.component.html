<app-header></app-header>

<div class="score-game-container">
  <!-- Main Game Section -->
  <div class="main-game-section">
    <!-- Timer Display with Live Indicator or Start Button -->
    <div class="timer-section">
      <!-- Show timer when match is started -->
      <div class="timer-display" *ngIf="isMatchStarted">
        {{ formatTime(secondsElapsed) }}
      </div>
      <!-- Finish Match Button (under timer) -->
    
      <!-- Show start button when match hasn't started -->
      <button 
        *ngIf="!isMatchStarted && !isMatchFinished" 
        class="btn btn-start" 
        (click)="startMatch()">
        <i class="fas fa-play"></i> COMEÃ‡AR JOGO
      </button>
      <!-- Live Indicator positioned on the right -->
      <div class="live-indicator-container" *ngIf="isRecordingMode && isMatchStarted">
        <app-live-indicator [isRecording]="isRecording"></app-live-indicator>
      </div>
    </div>

    

    <!-- Final Result Display (under timer) -->
    <div *ngIf="showFinalResult" class="final-result">
      <div class="ft-text">FINAL DO JOGO</div>
    </div>

    <!-- Teams and Score Row -->
    <div class="row align-items-center justify-content-center">
      <!-- Team A -->
      <div class="col-3 text-center">
        <div class="team-content" 
             *ngIf="!showControls" 
             (click)="editTeam('A')" 
             title="Click to edit team">
          <div class="team-icon" [style.color]="teamAColor">
            <i class="fas fa-tshirt"></i>
          </div>
          <div class="team-name">
            {{ teamAName }}
          </div>
        </div>
        <div class="team-content" *ngIf="showControls">
          <div class="team-icon" [style.color]="teamAColor">
            <i class="fas fa-tshirt"></i>
          </div>
          <div class="team-name">
            {{ teamAName }}
          </div>
        </div>
      </div>

      <!-- Score Display -->
      <div class="col-5 text-center">
        <div class="score">
          {{ teamAScore }} - {{ teamBScore }}
        </div>
        <!-- Access Video Button (only shown when match is finished and QR modal is closed) -->
        <div *ngIf="isMatchFinished && isRecordingMode && !showQrModal" class="access-video-section">
          <button class="btn btn-access-video" (click)="showQrModal = true">
            <i class="fas fa-video"></i> Aceder ao VÃ­deo
          </button>
        </div>
      </div>

      <!-- Team B -->
      <div class="col-3 text-center">
        <div class="team-content" 
             *ngIf="!showControls" 
             (click)="editTeam('B')" 
             title="Click to edit team">
          <div class="team-icon" [style.color]="teamBColor">
            <i class="fas fa-tshirt"></i>
          </div>
          <div class="team-name">
            {{ teamBName }}
          </div>
        </div>
        <div class="team-content" *ngIf="showControls">
          <div class="team-icon" [style.color]="teamBColor">
            <i class="fas fa-tshirt"></i>
          </div>
          <div class="team-name">
            {{ teamBName }}
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons Row -->
    <div class="row align-items-center justify-content-center mb-4" *ngIf="showControls">
      <!-- Team A Goal Button -->
      <div class="col-3 text-center">
        <button class="btn btn-goal team-a-goal" (click)="addTeamGoal('A')">
          <i class="fas fa-futbol"></i>
        </button>
      </div>

      <!-- Highlight Button -->
      <div class="col-5 text-center">
        <button class="btn btn-highlight" (click)="addHighlight()">
          <i class="fas fa-star"></i>
        </button>
      </div>

      <!-- Team B Goal Button -->
      <div class="col-3 text-center">
        <button class="btn btn-goal team-b-goal" (click)="addTeamGoal('B')">
          <i class="fas fa-futbol"></i>
        </button>
      </div>
    </div>

    <!-- Event Logs -->
    <app-event-log
      [teamAEvents]="teamAEvents"
      [teamBEvents]="teamBEvents"
      [highlightEvents]="highlightEvents"
      [showControls]="showControls"
      [teamAScore]="teamAScore"
      [teamBScore]="teamBScore"
      [teamAColor]="teamAColor"
      [teamBColor]="teamBColor"
      (undoTeamA)="decreaseTeamGoal('A')"
      (undoTeamB)="decreaseTeamGoal('B')"
    ></app-event-log>

    <div class="finish-button-section" *ngIf="isMatchStarted && !isMatchFinished">
      <button class="btn btn-finish-small" (click)="finishMatch()">
        <i class="fas fa-stop"></i> TERMINAR
      </button>
    </div>
  </div>

  <!-- Team Edit Modal -->
  <app-team-edit-modal
    [isOpen]="showEditModal"
    [teamData]="teamEditData"
    (save)="onTeamEditSave($event)"
    (cancel)="onTeamEditCancel()"
  ></app-team-edit-modal>

  <!-- Start Match Confirmation Modal -->
  <app-confirmation-modal
    [isVisible]="showStartConfirmModal"
    title="Start New Match"
    message="Starting a new match will clear the current events. Proceed?"
    confirmText="Start Match"
    cancelText="Cancel"
    (confirm)="onConfirmStartMatch()"
    (cancel)="onCancelStartMatch()"
  ></app-confirmation-modal>

  <!-- Finish Match Confirmation Modal -->
  <app-confirmation-modal
    [isVisible]="showConfirmModal"
    [title]="isRecordingMode ? 'Terminar o jogo e gravaÃ§Ã£o' : 'Terminar o Jogo'"
    [message]="isRecordingMode ? 'Tens a certeza que queres terminar o jogo e parar a gravaÃ§Ã£o?' : 'Tens a certeza que queres terminar o jogo?'"
    confirmText="Terminar o Jogo"
    cancelText="Cancelar"
    (confirm)="onConfirmFinishMatch()"
    (cancel)="onCancelFinishMatch()"
  ></app-confirmation-modal>

  <!-- QR Code Modal (only shown in recording mode) -->
  <app-qr-modal
    *ngIf="isRecordingMode"
    [isVisible]="showQrModal"
    [gameId]="gameId"
    [qrCodeData]="qrCodeData"
    (closeModal)="onCloseQrModal()"
  ></app-qr-modal>

  <!-- Photo Capture Modal -->
  <div class="photo-capture-modal" *ngIf="isCapturingPhoto">
    <div class="photo-capture-content">
      <div class="photo-capture-header">
        <h3>ðŸ“¸ Querem tirar a foto de final de Jogo?</h3>
      </div>
      
      <div class="photo-capture-body">
        <div class="photo-preview" *ngIf="photoUploadProgress === 0">
          <div class="camera-icon">
            <i class="fas fa-camera"></i>
          </div>
          <p>A Camera irÃ¡ abrir assim que clicarem no botÃ£o de "Tirar Foto"</p>
        </div>
        
        <div class="upload-progress" *ngIf="photoUploadProgress > 0">
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="photoUploadProgress"></div>
          </div>
          <p *ngIf="photoUploadProgress < 100">Uploading photo...</p>
          <p *ngIf="photoUploadProgress === 100">Photo uploaded successfully!</p>
        </div>
      </div>
      
      <div class="photo-capture-controls">
        <button 
          class="btn btn-secondary" 
          (click)="skipPhotoCapture()"
          [disabled]="photoUploadProgress > 0">
          NÃ£o tirar
        </button>
        <button 
          class="btn btn-primary" 
          (click)="retryPhotoCapture()"
          [disabled]="photoUploadProgress > 0">
          <i class="fas fa-camera"></i> Tirar Foto
        </button>
      </div>
    </div>
  </div>

  <!-- Large Photo Preview Modal -->
  <div class="photo-preview-modal" *ngIf="showPhotoPreviewModal">
    <div class="photo-preview-content">
      <button class="close-preview-btn" (click)="closePhotoPreview()">&times;</button>
      <h3>Match Photo</h3>
      <img *ngIf="lastCapturedPhotoUrl" [src]="lastCapturedPhotoUrl" alt="Match photo" class="photo-preview-image" />
    </div>
  </div>
</div>
